#:kivy 2.1.0
#:import colors colors
#:import utilities utilities

# Root widget for the VideoboxApp class
Videobox:
    orientation: "vertical"
    # Toolbar 
    BoxLayout:
        size_hint: 1, None
        padding: 5
        Button:
            text: "Sync Now"
            size_hint: None, None
            on_press: app.start_sync()

        # Button:
        #     text: "Sync Now"
        #     size_hint: None, None
        #     on_press: app.start_sync()

        # Button:
        #     text: "Sync Now"
        #     size_hint: None, None
        #     on_press: app.start_sync()

    PageLayout:
        id: home_nav
        border: 0
        ScrollView:
            canvas.before:
                Color:
                    rgba: 1, .1, .1, .8
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height 
            do_scroll_x: False
            size_hint_y: 1
            Home:

    # Bubble:
    #     size_hint: (None, None)
    #     size: (300, 150)    
    #     pos_hint: {'center_x': .5, 'y': 0}
    #     arrow_pos: 'top_mid'
    Transfers:

<Welcome@Label>:
    text: "Videobox is starting..."
    font_size: 21

<Home>: 
    # Data-bound children
    featured_grid: featured
    # new_grid: new
    # running_grid: running
    orientation: "vertical"
    size_hint_y: None
    height: self.minimum_height
    padding: 20

    GridLayout:
        id: featured
        cols: 6
        rows: 2
        row_default_height: 250
        spacing: 10
        #height: self.minimum_height
        canvas.before:
            Color:
                rgba: .1, 1, 1, 1
            Line:
                width: 1
                rectangle: self.x, self.y, self.width, self.height        
    # GridLayout:
    #     id: new
    #     cols: 6
    #     spacing: 10
    #     #size_hint_y: 0.33
    #     canvas.before:
    #         Color:
    #             rgba: 1, .1, .1, 1
    #         Line:
    #             width: 1
    #             rectangle: self.x, self.y, self.width, self.height           
    # GridLayout:
    #     id: running
    #     cols: 6
    #     spacing: 10
    #     #size_hint_y: 0.33
    #     canvas.before:
    #         Color:
    #             rgba: .1, .1, 1, 1
    #         Line:
    #             width: 1
    #             rectangle: self.x, self.y, self.width, self.height   

<SeriesThumbnail>:
    spacing: 10
    orientation: "vertical"
    # canvas.before:
    #     Color:
    #         rgba: .1, .1, 1, 1
    #     Line:
    #         width: 1
    #         rectangle: self.x, self.y, self.width, self.height
    ImageButton:
        source: root.poster_url
        on_press: root.on_series_clicked()     
        height: 200
        size_hint: 1, None
        # canvas.before:
        #     Color:
        #         rgba: 1, .1, .1, 1
        #     Line:
        #         width: 1
        #         rectangle: self.x, self.y, self.width, self.height        
    LabelButton:
        #text: f"{root.label} â€¢ {root.id}"
        text: f"{root.label}"
        # height: self.texture_size[1] # Set height exactly to rendered text size
        # size_hint_y: None

<WrappedLabel@Label>:
    text_size: self.width, None
    size_hint: 1, None

<LabelButton>:
    background_color: colors.TRANSPARENT
    height: self.texture_size[1] # Set height exactly to rendered text size
    #size_hint_y: None


<SeriesDetail>:
    #id: series_detail
    # Data-bound children
    episode_list: episodes

    orientation: "vertical"    
    padding: 20

    canvas.before:
        Color:
            rgba: colors.GRAY_800
        Rectangle:
            pos: self.pos 
            size: self.size         

    Button: 
        text: "Back"
        on_press: root.on_back_clicked()
        size_hint: None, None
    
    BoxLayout: 
        AsyncImage:
            source: root.poster_url
            size_hint_max: 300, None
        BoxLayout:
            orientation: "vertical"
            padding: 10
            spacing: 10
            #size_hint_y: None
            Label:
                text: root.network
                font_size: 13
                height: self.texture_size[1]
                size_hint_y: None
                text_size: self.size
                halign: 'left'
                bold: True
            Label:
                text: root.name
                font_size: 21
                bold: True 
                height: self.texture_size[1]
                size_hint_y: None
                text_size: self.size
                halign: 'left'
                canvas.before:
                    Color:
                        rgba: .1, .1, 1, 1
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height                          
            WrappedLabel:
                text: root.overview        
                height: self.texture_size[1]
                canvas.before:
                    Color:
                        rgba: 1, .1, .1, 1
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height                           
            BoxLayout:
                id: episodes
                orientation: "vertical"
                spacing: 5
                canvas.before:
                    Color:
                        rgba: 1, .1, .1, 1
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height                   


<EpisodeListItem>:
    LabelButton:
        text: root.name
        on_press: root.on_episode_clicked()    
        text_size: self.size # Set to text size so left aligment is effective
        height: self.texture_size[1]
        size_hint_y: None
    # Label:
    #     aired_on: root.aired_on

# Base styles for nav panels
# <HomeNavPanel@BoxLayout>:
#     canvas.before:
#         Color:
#             rgba: colors.GRAY_800
#         Rectangle:
#             pos: self.pos 
#             size: self.size      

<EpisodeDetail>:
    #d: episode_detail
    # Data-bound children
    release_list: releases

    orientation: "vertical"    
    padding: 20

    canvas.before:
        Color:
            rgba: colors.GRAY_800
        Rectangle:
            pos: self.pos 
            size: self.size         

    Button: 
        text: "Back"
        on_press: root.on_back_clicked()
        size_hint: None, None
    
    BoxLayout: 
        AsyncImage:
            source: root.thumbnail_url
            size_hint_max: 200, None
        BoxLayout:
            orientation: "vertical"
            padding: 10
            spacing: 10
            Label:
                text: root.name
                font_size: 21
                bold: True 
                height: self.texture_size[1]
                size_hint_y: None
                text_size: self.size
                halign: 'left'
            WrappedLabel:
                height: self.texture_size[1]
                text: root.overview
            BoxLayout:
                id: releases
                orientation: "vertical"
                spacing: 5


<ReleaseListItem>:
    text: f"{root.name} ({utilities.format_size(root.size2)})"
    text_size: self.size # Real text size so left aligment is effective
    
    on_press: app.on_release_clicked(self.id)     

# ---------------------
# Transfers
# ---------------------

<Transfers>:
    # Data-bound children
    transfer_list: transfers
    
    orientation: "vertical"
    size_hint_y: 0.25
    canvas.before:
        Color:
            rgba: colors.GRAY_700
        Rectangle:
            pos: self.pos 
            size: self.size
    Label:
        text: "Transfers"
        font_size: 18
        bold: True
        #color: colors.GRAY_800

    BoxLayout:
        id: transfers
        orientation: "vertical"
        spacing: 10        

<TransferListItem>:
    orientation: "vertical"
    spacing: 5
    Label:
        text: root.name
    ProgressBar:
        max: 100
        value: root.progress
    Label:
        text: root.stats