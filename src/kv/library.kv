#:kivy 2.1.0
#:import colors colors
#:import utilities utilities

# -------------------
# Library navigation and panels
# -------------------

<Library>:
    id: library
    orientation: "vertical"
    # Toolbar 
    RowLayout:
        padding: 10
        spacing: 5
        canvas.before:
            Color:
                rgba: colors.GRAY_800
            Rectangle:
                pos: self.pos 
                size: self.size
        ToolbarButton:
            text: "Sync Now"
            on_press: app.start_sync()

        ToolbarButton:
            text: "Some Button"             

        ToolbarButton:
            text: "Other Button"

    BoxLayout:
        spacing: 5
        Sidebar:
            # Pass            
        # Library content
        PageLayout:
            id: home_nav
            border: 0
            ScrollView:
                # canvas.before:
                #     Color:
                #         rgba: 1, .1, .1, .8
                #     Line:
                #         width: 1
                #         rectangle: self.x, self.y, self.width, self.height 
                do_scroll_x: False
                size_hint_y: 1
                Home:

    # Bubble:
    #     size_hint: (None, None)
    #     size: (300, 150)    
    #     pos_hint: {'center_x': .5, 'y': 0}
    #     arrow_pos: 'top_mid'
    Transfers:

<Sidebar@ColumnLayout>:
    width: 200
    size_hint: None, 1
    padding: 10
    spacing: 5
    canvas.before:
        Color:
            rgba: colors.GRAY_800
        Rectangle:
            pos: self.pos 
            size: self.size
    SmallLabel:
        text: "SERIES"
        size_hint_y: None     
        bold: True
    LabelButton:
        text: "Some nav items 2"
        size_hint_y: None
        padding_x: 15
    LabelButton:
        text: "Some items"
        size_hint_y: None
        padding_x: 15        
    SmallLabel:
        text: "TAGS"
        size_hint_y: None      
        bold: True
    LabelButton:
        text: "Some nav items"
        size_hint_y: None
        padding_x: 15           
    LabelButton:
        text: "Some items"
        size_hint_y: None
        padding_x: 15           
    LabelButton:
        text: "Some nav items"
        size_hint_y: None
        padding_x: 15           
    LabelButton:
        text: "Some items"
        size_hint_y: None
        padding_x: 15   
    SmallLabel:
        text: "EPISODES"
        size_hint_y: None      
        bold: True
    LabelButton:
        text: "Some nav items"
        size_hint_y: None
        padding_x: 15           
    LabelButton:
        text: "Some items"
        size_hint_y: None
        padding_x: 15           
    LabelButton:
        text: "Some nav items"
        size_hint_y: None
        padding_x: 15           
    LabelButton:
        text: "Some items"
        size_hint_y: None
        padding_x: 15   


<Home>: 
    # Data-bound children
    featured_grid: featured
    new_grid: new
    running_grid: running

    cols: 1
    size_hint_y: None
    height: self.minimum_height
    padding: 10
    spacing: 20

    TitleLabel: 
        text: "Featured"    

    GridLayout:
        id: featured
        cols: 6
        rows: 2
        spacing: 10
        height: self.minimum_height
        size_hint_y: None   

    TitleLabel: 
        text: "New This Week"    

    GridLayout:
        id: new
        cols: 6
        spacing: 10
        height: self.minimum_height
        size_hint_y: None     

    TitleLabel: 
        text: "More"    

    GridLayout:
        id: running
        cols: 6
        rows: 2
        spacing: 10
        height: self.minimum_height
        size_hint_y: None

<SeriesThumbnail>:
    cols: 1
    size_hint: 1, None
    height: self.minimum_height
    spacing: 10
    ImageButton:
        source: root.poster_url
        on_press: root.on_series_clicked()     
        height: 200
        size_hint: 1, None    
    LabelButton:
        text: root.label
        halign: "center"
        size_hint: 1, None


<SeriesDetail>:
    #id: series_detail
    # Data-bound children
    episode_list: episodes

    orientation: "vertical"    
    padding: 20

    canvas.before:
        Color:
            rgba: colors.GRAY_900
        Rectangle:
            pos: self.pos 
            size: self.size         

    ToolbarButton: 
        text: "Back"
        on_press: root.on_back_clicked()
        size_hint: None, None
    
    BoxLayout: 
        AsyncImage:
            source: root.poster_url
            size_hint_max: 300, None
        BoxLayout:
            orientation: "vertical"
            padding: 10
            spacing: 10
            #size_hint_y: None
            Label:
                text: root.network
                font_size: 13
                height: self.texture_size[1]
                size_hint_y: None
                text_size: self.size
                halign: 'left'
                bold: True
            Label:
                text: root.name
                font_size: 21
                bold: True 
                height: self.texture_size[1]
                size_hint_y: None
                text_size: self.size
                halign: 'left'
                canvas.before:
                    Color:
                        rgba: .1, .1, 1, 1
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height                          
            WrappedLabel:
                text: root.overview        
                height: self.texture_size[1]
                canvas.before:
                    Color:
                        rgba: 1, .1, .1, 1
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height                           
            GridLayout:
                id: episodes
                cols: 1
                spacing: 13
                size_hint_y: None
                height: self.minimum_height
                canvas.before:
                    Color:
                        rgba: 1, .1, .1, 1
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height                   


<EpisodeListItem>:
    orientation: "vertical"
    height: 32  # This seems required ;( 
    size_hint_y: None
    spacing: 7
    LabelButton:
        text: root.name
        on_press: root.on_episode_clicked()    
        #size_hint_y: None
    SmallLabel:
        markup: True
        text: root.aired_on

# Base styles for nav panels
# <HomeNavPanel@BoxLayout>:
#     canvas.before:
#         Color:
#             rgba: colors.GRAY_800
#         Rectangle:
#             pos: self.pos 
#             size: self.size      

<EpisodeDetail>:
    # Data-bound children
    release_list: releases

    orientation: "vertical"    
    padding: 20

    canvas.before:
        Color:
            rgba: colors.GRAY_900
        Rectangle:
            pos: self.pos 
            size: self.size         

    Button: 
        text: "Back"
        on_press: root.on_back_clicked()
        size_hint: None, None
    
    ScrollView:
        do_scroll_x: False               
        # BoxLayout:
        #     canvas.before:
        #         Color:
        #             rgba: 1, .1, .1, 1
        #         Line:
        #             width: 1
        #             rectangle: self.x, self.y, self.width, self.height             
        #     size_hint_y: None
            # AsyncImage:
            #     source: root.thumbnail_url
            #     size_hint_max: 200, None
            # GridLayout:
            #     cols: 1
            #     #padding: 10
            #     spacing: 10
            #     #size_hint_y: None
            #     height: self.minimum_height
            #     Label:
            #         text: root.name
            #         font_size: 21
            #         bold: True 
            #         height: self.texture_size[1]
            #         text_size: self.width, None                
            #         size_hint_y: None
                # WrappedLabel:
                #     height: self.texture_size[1]
                #     text: root.overview
        GridLayout:
            id: releases
            cols: 1
            spacing: 10
            size_hint_y: None
            height: self.minimum_height


<ReleaseListItem>:    
    orientation: "vertical"
    height: 32  # This seems required ;( 
    size_hint_y: None
    spacing: 7
    # canvas.before:
    #     Color:
    #         rgba: .1, 1, .1, 1
    #     Line:
    #         width: 1
    #         rectangle: self.x, self.y, self.width, self.height          
    LabelButton:
        text: f"{root.name} â€¢ {utilities.format_size(root.torrent_size)}"
        #size_hint_y: 0.5
        # canvas.before:
        #     Color:
        #         rgba: 1, .1, 1, 1
        #     Line:
        #         width: 1
        #         rectangle: self.x, self.y, self.width, self.height        

        on_press: app.on_release_clicked(root.id)
    SmallLabel:
        text: f"Added on {root.added_on}, shared by {root.seeds} people"
        #size_hint_y: 0.5


